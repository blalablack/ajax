<!DOCTYPE html>
<html>
 <head>
  <meta charset="UTF-8">
  <title>HTML5</title>
  <style type="text/css">
	
  </style>
 </head>
 <body>
   <select id="province">
    <option label="--请选择--"/>
   </select>
   <select id="city">
	<option>--请选择--</option>
	
   </select>
   <select id="vilige">
	<option>--请选择--</option>
   <select>

 </body>
 <script src="myutils.js"></script>
 <script>
	var provinceSel=document.getElementById("province");
	var citySel=document.getElementById("city");
	var viligeSel=document.getElementById("vilige");
	var xhr=getXHR();
	
	var xhr=getXHR();
	xhr.open("GET","province.php");
	xhr.send(null);
	xhr.onreadystatechange=function(){
		if(xhr.readyState==4&&xhr.status==200){
			var provinces=xhr.responseText;
			console.log(provinces);
			var provinceArr=provinces.split(",");
			for(var i=0;i<provinceArr.length;i++){
				var province=provinceArr[i];
				var option=document.createElement("option");
				option.innerHTML=province;

				provinceSel.appendChild(option);
			}
		}
	};
	provinceSel.onchange=function(){
		var cityoptions = citySel.getElementsByTagName("option");
		//tagName返回的类数组对象。cityoptions会随时根据下面的内容改变所以不能用z改用1。
		var len=cityoptions.length;
		for(var z=1;z<len;z++){
			var cityoption = cityoptions[1];
			citySel.removeChild(cityoption);
		}
		var provinceValue;
		var optionss=provinceSel.querySelectorAll("option");
		for(var i=0;i<optionss.length;i++){
			var option=optionss[i];
			if(option.selected){
				provinceValue=option.value;
				break;
			}
		}
	
		xhr.open("GET","city.php",true);
		xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
		xhr.send("province="+provinceValue);
		xhr.onreadystatechange = function(){
			if(xhr.readyState==4&&xhr.status==200){
				var cities = xhr.responseText;
				var citiesArr = cities.split(",");
				for(var i=0;i<citiesArr.length;i++){
					var city = citiesArr[i];
					var option = document.createElement("option");
					var textEle = document.createTextNode(city);
					option.appendChild(textEle);

					
					citySel.appendChild(option);
				}
			}
		}
	};
	citySel.onchange=function(){
		var viligeoptions=viligeSel.querySelectorAll("option");
		for(var m=1;m<viligeoptions.length;m++){
			var viligeoption=viligeoptions[m];
			viligeSel.removeChild(viligeoption);
		}
		var cityValue;   
		var optionss=citySel.querySelectorAll("option");
		for(var i=0;i<optionss.length;i++){
			var optionCity=optionss[i];
			if(optionCity.selected){
				cityValue=optionCity.value;
				break;
			}
		}
		xhr.open("GET","vilige.php",true);
		xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
		xhr.send("city="+cityValue);
		
		xhr.onreadystatechange=function(){
			if(xhr.readyState==4&&xhr.status==200){
				
				var viliges=xhr.responseText;
				var viligeAll=viliges.split(",");
				for(var n=0;n<viligeAll.length;n++){
					var vilige=viligeAll[n];
					var option=document.createElement("option");
					option.innerHTML=vilige;
				
					viligeSel.appendChild(option);
				}
			}
		}

	}
		
 </script>
</html>
